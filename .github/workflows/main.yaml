name: Deploy to Render

on:
  push:
    branches:
      - main

jobs:
  main:
    name: Deploy to Render
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Build Docker image
        uses: docker/build-push-action@v2
        with:
          push: true
          tags: render/${{ env.RENDER_APP_NAME }}:${{ env.APP_VERSION }}

      - name: Deploy to Render
        uses: sws2apps/render-deployment@main # consider using a pinned version
        with:
          serviceId: ${{ secrets.RENDER_SERVICE_ID }}
          apiKey: ${{ secrets.ML_MODEL_RENDER_API_KEY }}
          imageName: render/${{ env.RENDER_APP_NAME }}
          imageTag: ${{ env.APP_VERSION }}
          # env: ${{ env.ENV_VARIABLES }}
